<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#7c2d12">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎃 Spooky Sliding Puzzle 👻</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        /* 原有的动画定义保持不变 */
        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }

            25% {
                transform: translateY(-20px) rotate(5deg);
            }

            50% {
                transform: translateY(-40px) rotate(-5deg);
            }

            75% {
                transform: translateY(-20px) rotate(3deg);
            }
        }

        @keyframes glow {
            0%, 100% {
                box-shadow: 0 0 20px rgba(255, 107, 53, 0.5), 0 0 40px rgba(255, 107, 53, 0.3);
            }

            50% {
                box-shadow: 0 0 40px rgba(255, 107, 53, 0.8), 0 0 60px rgba(255, 107, 53, 0.5);
            }
        }

        @keyframes shake {
            0%, 100% {
                transform: rotate(0deg);
            }

            25% {
                transform: rotate(-3deg);
            }

            75% {
                transform: rotate(3deg);
            }
        }

        @keyframes bloodSlide {
            0% {
                box-shadow: 0 0 0 rgba(139, 0, 0, 0);
            }

            50% {
                box-shadow: 0 0 30px rgba(139, 0, 0, 0.8), 0 0 50px rgba(220, 20, 60, 0.6);
            }

            100% {
                box-shadow: 0 0 0 rgba(139, 0, 0, 0);
            }
        }

        .blood-slide {
            animation: bloodSlide 0.3s ease-out;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
        }

        /* 移动端性能优化 */
        @media (max-width: 768px) {
            .blood-slide {
                animation: bloodSlide 0.2s ease-out;
            }

            /* 禁用部分动画以减少闪烁 */
            .animate-pulse {
                animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
            }

            /* 使用标准CSS替代Tailwind伪类 */
            .tile-hover-disable:hover {
                transform: none !important;
            }
        }

        /* 硬件加速 */
        .gpu-accelerated {
            transform: translateZ(0);
            -webkit-transform: translateZ(0);
        }

        /* 防止文本选择 - 移除过时前缀 */
        .no-select {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        /* 移动端激活状态 */
        .tile-active:active {
            transform: scale(0.95) rotate(2deg);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
    const { useState, useEffect, useRef } = React;
        // 防止移动端页面滚动和保持活跃的代码
document.addEventListener('touchmove', function(e) {
  if (e.target.closest('#root')) {
    e.preventDefault();
  }
}, { passive: false });

// 防止页面休眠
let keepAliveTimer;
function keepPageAlive() {
  if (document.hidden) return;
  keepAliveTimer = setTimeout(keepPageAlive, 30000);
}
document.addEventListener('visibilitychange', function() {
  if (!document.hidden) {
    keepPageAlive();
  } else {
    clearTimeout(keepAliveTimer);
  }
});
keepPageAlive();

    // ═══════════════════════════════════════════════════════════════════════
    // 🔥 FIREBASE CONFIGURATION - REPLACE WITH YOUR CONFIG FROM FIREBASE CONSOLE
    // ═══════════════════════════════════════════════════════════════════════
    //
    // HOW TO GET YOUR CONFIG:
    // 1. Go to https://console.firebase.google.com/
    // 2. Select your project (or create a new one)
    // 3. Click the gear icon ⚙️ > Project Settings
    // 4. Scroll down to "Your apps" section
    // 5. Click the web icon </> to register your app
    // 6. Copy the firebaseConfig object and paste it below
    //
    // IMPORTANT: Replace ALL values below with your actual Firebase config
    // ═══════════════════════════════════════════════════════════════════════

    const firebaseConfig = {
    apiKey: "AIzaSyCdyeAVxETu5upcMAIWIKi5ykuqcuhSDXk",
    authDomain: "spooky-puzzle-game-7dcf4.firebaseapp.com",
    projectId: "spooky-puzzle-game-7dcf4",
    storageBucket: "spooky-puzzle-game-7dcf4.firebasestorage.app",
    messagingSenderId: "838626431807",
    appId: "1:838626431807:web:c0c6e5d151e395f3e8b98a"
    };

        // 保存游戏状态到本地存储
function saveGameState(state) {
    try {
        localStorage.setItem('spooky_puzzle_state', JSON.stringify(state));
    } catch (e) {
        console.log('Could not save game state');
    }
}

// 从本地存储加载游戏状态
function loadGameState() {
    try {
        const saved = localStorage.getItem('spooky_puzzle_state');
        return saved ? JSON.parse(saved) : null;
    } catch (e) {
        return null;
    }
}
    // ═══════════════════════════════════════════════════════════════════════
    // END OF FIREBASE CONFIGURATION
    // ═══════════════════════════════════════════════════════════════════════

    // Initialize Firebase
    let db = null;
    let firebaseInitialized = false;

    try {
      if (firebaseConfig.apiKey !== "YOUR_API_KEY_HERE") {
        if (!firebase.apps.length) {
          firebase.initializeApp(firebaseConfig);
        }
        db = firebase.firestore();
        firebaseInitialized = true;
        console.log("✅ Firebase initialized successfully! Global leaderboard is active.");
      } else {
        console.log("⚠️ Firebase not configured. Using local storage only.");
        console.log("📝 To enable global leaderboard, update the firebaseConfig in the HTML file.");
      }
    } catch (error) {
      console.error("❌ Firebase initialization error:", error);
      console.log("📝 Using local storage fallback.");
    }



    function SlidingPuzzle() {

      const [isMobile, setIsMobile] = useState(false);
      const saveGameStateDebounced = useRef(null);
      const [tiles, setTiles] = useState([0, 1, 2, 3, 4, 5, 6, 7, 8]);
      const [moves, setMoves] = useState(0);
      const [image, setImage] = useState(null);
      const [isWon, setIsWon] = useState(false);
      const [floatingIcons, setFloatingIcons] = useState([]);
      const [playerName, setPlayerName] = useState('');
      const [showNameInput, setShowNameInput] = useState(false);
      const [leaderboard, setLeaderboard] = useState([]);
      const [showLeaderboard, setShowLeaderboard] = useState(false);
      const [startTime, setStartTime] = useState(null);
      const [completionTime, setCompletionTime] = useState(0);
      const [animatingTile, setAnimatingTile] = useState(null);
      const fileInputRef = useRef(null);

      // 在 SlidingPuzzle 组件中添加
useEffect(() => {
  const checkScreenSize = () => {
    setIsMobile(window.innerWidth < 768);
  };

  checkScreenSize();
  window.addEventListener('resize', checkScreenSize);

  return () => {
    window.removeEventListener('resize', checkScreenSize);
  };
}, []);
useEffect(() => {
  if (saveGameStateDebounced.current) {
    clearTimeout(saveGameStateDebounced.current);
  }

  saveGameStateDebounced.current = setTimeout(() => {
    const gameState = {
      tiles,
      moves,
      image,
      startTime,
      completionTime
    };
    saveGameState(gameState);
    saveGameStateDebounced.current = null;
  }, 500); // 500ms防抖

  return () => {
    if (saveGameStateDebounced.current) {
      clearTimeout(saveGameStateDebounced.current);
    }
  };
}, [tiles, moves, image, startTime, completionTime]);
useEffect(() => {
  // 保存游戏状态
  const gameState = {
    tiles,
    moves,
    image,
    startTime,
    completionTime
  };
  saveGameState(gameState);
}, [tiles, moves, image, startTime, completionTime]);

// 组件挂载时加载保存的状态
useEffect(() => {
  const savedState = loadGameState();
  if (savedState) {
    setTiles(savedState.tiles || [0,1,2,3,4,5,6,7,8]);
    setMoves(savedState.moves || 0);
    setImage(savedState.image || null);
    setStartTime(savedState.startTime || null);
    setCompletionTime(savedState.completionTime || 0);
  }
}, []);

// 减少浮动图标数量（移动端）
useEffect(() => {
  const isMobile = window.innerWidth < 768;
  const totalIcons = isMobile ? 20 : 50; // 移动端减少图标数量

  const icons = ['👻', '🎃', '🦇', '🕷️', '💀', '🕸️', '🐈‍⬛'];
  const positions = [];

  for (let i = 0; i < totalIcons; i++) {
    const isLeft = i < totalIcons / 2;
    positions.push({
      id: `${isLeft ? 'left' : 'right'}-${i}`,
      icon: icons[Math.floor(Math.random() * icons.length)],
      left: isLeft ?
        (2 + Math.random() * 15) :
        (70 + Math.random() * (30 - 3)),
      top: 5 + Math.random() * 90,
      size: Math.random() * 2 + 1.5, // 减小尺寸
      duration: Math.random() * 15 + 10, // 减慢动画
      delay: Math.random() * 5
    });
  }

  setFloatingIcons(positions);
}, []);

      const loadLeaderboard = async () => {
  console.log('Loading leaderboard...'); // 调试日志

  // 先尝试Firebase
  if (db && firebaseInitialized) {
    try {
      const snapshot = await db.collection('scores')
        .orderBy('moves')
        .orderBy('time')
        .limit(50)
        .get();

      const scores = [];
      snapshot.forEach(doc => {
        const data = doc.data();
        scores.push({
          ...data,
          id: doc.id, // 添加文档ID用于key属性
          timestamp: data.timestamp || Date.now() // 确保有时间戳
        });
      });

      console.log('Firebase scores loaded:', scores.length); // 调试日志
      setLeaderboard(scores);
      return;
    } catch (error) {
      console.error('Error loading Firebase leaderboard:', error);
      console.log('Falling back to local storage...');
    }
  }

  // Fallback to local storage
  loadLocalLeaderboard();
};

const loadLocalLeaderboard = () => {
  try {
    const stored = localStorage.getItem('spooky_leaderboard');
    if (stored) {
      const scores = JSON.parse(stored);
      // 确保正确排序
      scores.sort((a, b) => {
        if (a.moves !== b.moves) return a.moves - b.moves;
        return a.time - b.time;
      });
      console.log('Local scores loaded:', scores.length); // 调试日志
      setLeaderboard(scores);
    } else {
      setLeaderboard([]);
    }
  } catch (error) {
    console.error('Error loading local leaderboard:', error);
    setLeaderboard([]);
  }
};

      const checkWin = (currentTiles) => {
        return currentTiles.every((tile, index) => tile === index);
      };

      const getEmptyIndex = (currentTiles) => {
        return currentTiles.indexOf(8);
      };

      const canMove = (tileIndex, emptyIndex) => {
        const tileRow = Math.floor(tileIndex / 3);
        const tileCol = tileIndex % 3;
        const emptyRow = Math.floor(emptyIndex / 3);
        const emptyCol = emptyIndex % 3;

        return (
          (Math.abs(tileRow - emptyRow) === 1 && tileCol === emptyCol) ||
          (Math.abs(tileCol - emptyCol) === 1 && tileRow === emptyRow)
        );
      };

      const handleTileClick = (index) => {
        if (isWon) return;

        const emptyIndex = getEmptyIndex(tiles);

        if (canMove(index, emptyIndex)) {
          const newTiles = [...tiles];
          [newTiles[index], newTiles[emptyIndex]] = [newTiles[emptyIndex], newTiles[index]];
          setTiles(newTiles);
          setMoves(moves + 1);

          setAnimatingTile(emptyIndex);
          setTimeout(() => setAnimatingTile(null), 300);

          if (checkWin(newTiles)) {
            const endTime = Date.now();
            const timeTaken = Math.floor((endTime - startTime) / 1000);
            setCompletionTime(timeTaken);
            setIsWon(true);
            setShowNameInput(true);
          }
        }
      };

      const shuffleTiles = () => {
        let shuffled = [...tiles];

        for (let i = 0; i < 100; i++) {
          const emptyIndex = shuffled.indexOf(8);
          const validMoves = [];

          const row = Math.floor(emptyIndex / 3);
          const col = emptyIndex % 3;

          if (row > 0) validMoves.push(emptyIndex - 3);
          if (row < 2) validMoves.push(emptyIndex + 3);
          if (col > 0) validMoves.push(emptyIndex - 1);
          if (col < 2) validMoves.push(emptyIndex + 1);

          const randomMove = validMoves[Math.floor(Math.random() * validMoves.length)];
          [shuffled[emptyIndex], shuffled[randomMove]] = [shuffled[randomMove], shuffled[emptyIndex]];
        }

        setTiles(shuffled);
        setMoves(0);
        setIsWon(false);
        setStartTime(Date.now());
        setShowNameInput(false);
      };

      const resetPuzzle = () => {
        setTiles([0, 1, 2, 3, 4, 5, 6, 7, 8]);
        setMoves(0);
        setIsWon(false);
        setStartTime(null);
        setShowNameInput(false);
      };

      const handleImageUpload = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            setImage(event.target.result);
            resetPuzzle();
          };
          reader.readAsDataURL(file);
        }
      };

// 检查成绩是否更好
const isScoreBetter = (existingScore, newScore) => {
  // 先比较步数，步数少更好
  if (newScore.moves < existingScore.moves) return true;
  // 如果步数相同，比较时间，时间短更好
  if (newScore.moves === existingScore.moves && newScore.time < existingScore.time) return true;
  return false;
};

const saveScore = async () => {
    if (!playerName.trim()) {
        alert('Please enter your name! 👻');
        return;
    }

    const scoreData = {
        name: playerName.trim(),
        moves: moves,
        time: completionTime,
        timestamp: Date.now()
    };

    console.log('Saving score:', scoreData); // 调试日志

    // Try Firebase first
    if (db && firebaseInitialized) {
        try {
            // 检查是否已存在同名用户
            const existingScoresQuery = await db.collection('scores')
                .where('name', '==', playerName.trim())
                .get();

            let shouldSave = true;

            if (!existingScoresQuery.empty) {
                // 找到同名用户的最佳成绩
                let bestExistingScore = null;
                existingScoresQuery.forEach(doc => {
                    const data = doc.data();
                    if (!bestExistingScore || isScoreBetter(bestExistingScore, data)) {
                        bestExistingScore = data;
                    }
                });

                // 比较新成绩和现有最佳成绩
                if (bestExistingScore && !isScoreBetter(bestExistingScore, scoreData)) {
                    // 新成绩不比现有成绩好，不保存
                    shouldSave = false;
                    alert(`⚠️ You already have a better score: ${bestExistingScore.moves} moves in ${formatTime(bestExistingScore.time)}. This score was not saved.`);
                } else {
                    // 新成绩更好，删除所有旧成绩
                    const batch = db.batch();
                    existingScoresQuery.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    await batch.commit();
                }
            }

            if (shouldSave) {
                await db.collection('scores').add(scoreData);
                setShowNameInput(false);
                setPlayerName(''); // 清空名字输入框

                // 立即重新加载排行榜
                await loadLeaderboard();
                setShowLeaderboard(true);

                alert('🎉 Score saved to GLOBAL leaderboard! Everyone can see your achievement! 🏆');
            }
            return;
        } catch (error) {
            console.error('Failed to save to Firebase:', error);
            alert('⚠️ Could not save to global leaderboard. Saving locally instead...');
        }
    }

    // Fallback to local storage
    try {
        const stored = localStorage.getItem('spooky_leaderboard');
        const scores = stored ? JSON.parse(stored) : [];

        // 查找同名用户的现有成绩
        const existingScores = scores.filter(score => score.name === playerName.trim());
        let shouldSave = true;

        if (existingScores.length > 0) {
            // 找到同名用户的最佳成绩
            let bestExistingScore = existingScores[0];
            existingScores.forEach(score => {
                if (isScoreBetter(score, bestExistingScore)) {
                    bestExistingScore = score;
                }
            });

            // 比较新成绩和现有最佳成绩
            if (!isScoreBetter(bestExistingScore, scoreData)) {
                // 新成绩不比现有成绩好，不保存
                shouldSave = false;
                alert(`⚠️ You already have a better score: ${bestExistingScore.moves} moves in ${formatTime(bestExistingScore.time)}. This score was not saved.`);
            } else {
                // 新成绩更好，删除所有旧成绩
                scores = scores.filter(score => score.name !== playerName.trim());
            }
        }

        if (shouldSave) {
            scores.push(scoreData);

            // 确保正确排序
            scores.sort((a, b) => {
                if (a.moves !== b.moves) return a.moves - b.moves;
                return a.time - b.time;
            });

            // 只保留前50名
            const topScores = scores.slice(0, 50);

            localStorage.setItem('spooky_leaderboard', JSON.stringify(topScores));
            setShowNameInput(false);
            setPlayerName(''); // 清空名字输入框

            // 立即更新本地排行榜
            setLeaderboard(topScores);
            setShowLeaderboard(true);

            alert('🎉 Score saved locally! (Only you can see this score)');
        }
    } catch (error) {
        console.error('Failed to save score:', error);
        alert('❌ Failed to save score. Please try again.');
    }
};





      const formatTime = (seconds) => {
        const mins = Math.floor(seconds / 60);
        const secs = seconds % 60;
        return `${mins}:${secs.toString().padStart(2, '0')}`;
      };

      const getTileStyle = (tileNumber) => {
        if (tileNumber === 8) return {};

        const row = Math.floor(tileNumber / 3);
        const col = tileNumber % 3;

        return {
          backgroundImage: image ? `url(${image})` : 'linear-gradient(135deg, #ff6b35 0%, #8b0000 100%)',
          backgroundSize: '300%',
          backgroundPosition: `${col * 50}% ${row * 50}%`,
        };
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-orange-900 via-purple-900 to-black flex items-center justify-center p-4 relative overflow-y-auto">
          {floatingIcons.map((item) => (
            <div
              key={item.id}
              className="absolute animate-pulse opacity-20"
              style={{
                left: `${item.left}%`,
                top: `${item.top}%`,
                fontSize: `${item.size}rem`,
                animation: `float ${item.duration}s ease-in-out infinite`,
                animationDelay: `${item.delay}s`,
                pointerEvents: 'none'
              }}
            >
              {item.icon}
            </div>
          ))}

          <div className="bg-gradient-to-br from-gray-900 to-black rounded-2xl shadow-2xl p-4 md:p-8 max-w-md w-full border-4 border-orange-600 relative z-10 my-4 md:my-0">
            <div className="absolute top-0 left-0 text-6xl opacity-40 animate-pulse">🕸️</div>
            <div className="absolute top-0 right-0 text-6xl opacity-40 transform scale-x-[-1] animate-pulse">🕸️</div>
            <div className="absolute -top-6 left-1/2 transform -translate-x-1/2 text-5xl" style={{animation: 'shake 2s ease-in-out infinite'}}>🕷️</div>

            <div className="absolute -top-4 -left-4 text-4xl animate-bounce">🎃</div>
            <div className="absolute -top-4 -right-4 text-4xl animate-bounce" style={{animationDelay: '0.5s'}}>👻</div>
            <div className="absolute -bottom-4 -left-4 text-4xl animate-bounce" style={{animationDelay: '1s'}}>💀</div>
            <div className="absolute -bottom-4 -right-4 text-4xl animate-bounce" style={{animationDelay: '1.5s'}}>🦇</div>

            <h1 className="text-5xl font-bold text-center mb-2 text-orange-500 drop-shadow-lg animate-pulse" style={{fontFamily: 'Georgia, serif', textShadow: '0 0 20px rgba(255, 107, 53, 0.8)'}}>
              🎃 Spooky Puzzle 🎃
            </h1>
            <p className="text-center text-orange-300 mb-2 text-sm italic animate-pulse">
              Dare to solve it... if you can! 👻
            </p>
            {!firebaseInitialized && (
              <p className="text-center text-yellow-400 text-xs mb-4 bg-black bg-opacity-40 rounded px-2 py-1">
                ℹ️ Local mode - Configure Firebase for global leaderboard
              </p>
            )}
            {firebaseInitialized && (
              <p className="text-center text-green-400 text-xs mb-4 bg-black bg-opacity-40 rounded px-2 py-1">
                🌍 Global leaderboard active!
              </p>
            )}

            <div className="mb-6 flex flex-col gap-3">
              <input
                ref={fileInputRef}
                type="file"
                accept="image/*"
                onChange={handleImageUpload}
                className="hidden"
              />
              <button
                onClick={() => fileInputRef.current.click()}
                className="w-full bg-gradient-to-r from-purple-600 to-purple-800 hover:from-purple-700 hover:to-purple-900 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2 border-2 border-purple-400 shadow-lg hover:shadow-purple-500 hover:scale-105 active:scale-95"
              >
                📤 Upload Spooky Image 👻
              </button>

              <div className="flex gap-3">
                <button
                  onClick={shuffleTiles}
                  className="flex-1 bg-gradient-to-r from-orange-600 to-orange-800 hover:from-orange-700 hover:to-orange-900 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2 border-2 border-orange-400 shadow-lg hover:shadow-orange-500 hover:scale-105 active:scale-95"
                >
                  🔀 Haunt 🎃
                </button>
                <button
                  onClick={resetPuzzle}
                  className="flex-1 bg-gradient-to-r from-gray-600 to-gray-800 hover:from-gray-700 hover:to-gray-900 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2 border-2 border-gray-400 shadow-lg hover:shadow-gray-500 hover:scale-105 active:scale-95"
                >
                  ↺ Reset 🦇
                </button>
              </div>

              <button
                onClick={() => setShowLeaderboard(!showLeaderboard)}
                className="w-full bg-gradient-to-r from-yellow-600 to-yellow-800 hover:from-yellow-700 hover:to-yellow-900 text-white font-semibold py-3 px-4 rounded-lg transition-all flex items-center justify-center gap-2 border-2 border-yellow-400 shadow-lg hover:shadow-yellow-500 hover:scale-105 active:scale-95"
              >
                🏆 {showLeaderboard ? 'Hide' : 'Show'} Leaderboard 🏆
              </button>
            </div>

            {showLeaderboard && (
              <div className="mb-4 bg-black bg-opacity-80 rounded-lg p-4 border-2 border-yellow-500 max-h-64 overflow-y-auto">
                <h3 className="text-xl font-bold text-yellow-400 text-center mb-3 flex items-center justify-center gap-2">
                  🏆 Hall of Fame 🏆
                </h3>
                {leaderboard.length === 0 ? (
                  <p className="text-gray-400 text-center">No scores yet. Be the first! 👻</p>
                ) : (
                  <div className="space-y-2">
                    {leaderboard.map((score, index) => (
  <div
    key={score.id || score.timestamp || index} // 使用更可靠的key
    className={`flex items-center justify-between p-2 rounded ${
      index === 0
        ? 'bg-yellow-900 border-2 border-yellow-400'
        : index === 1
        ? 'bg-gray-700 border-2 border-gray-400'
        : index === 2
        ? 'bg-orange-900 border-2 border-orange-400'
        : 'bg-gray-800 border border-gray-600'
    }`}
  >
    <div className="flex items-center gap-3">
      <span className="text-2xl font-bold text-white">
        {index === 0 ? '🥇' : index === 1 ? '🥈' : index === 2 ? '🥉' : `#${index + 1}`}
      </span>
      <span className="text-white font-semibold">{score.name}</span>
    </div>
    <div className="flex items-center gap-3 text-sm">
      <span className="text-orange-300">{score.moves} moves</span>
      <span className="text-blue-300">⏱️ {formatTime(score.time)}</span>
    </div>
  </div>
))}
                  </div>
                )}
              </div>
            )}

            <div className="mb-4 text-center bg-black bg-opacity-50 rounded-lg p-3 border-2 border-orange-500 relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-orange-500 to-transparent animate-pulse"></div>
              <span className="text-xl font-bold text-orange-400 flex items-center justify-center gap-2">
                <span className="animate-pulse">👁️</span>
                Moves: <span className="text-orange-300 text-2xl">{moves}</span>
                <span className="animate-pulse">👁️</span>
              </span>
              <div className="absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-orange-500 to-transparent animate-pulse"></div>
            </div>

            {isWon && showNameInput && (
              <div className="mb-4 bg-gradient-to-r from-green-900 to-green-800 border-4 border-green-500 rounded-lg p-4 text-center shadow-xl relative overflow-hidden">
                <p className="text-green-300 font-bold text-3xl">🎉 BOO-tiful! 🎉</p>
                <p className="text-green-200 text-lg mt-2">You escaped in {moves} moves!</p>
                <p className="text-blue-200 text-md mt-1 flex items-center justify-center gap-2">
                  ⏱️ Time: {formatTime(completionTime)}
                </p>
                <p className="text-yellow-300 text-4xl mt-3 mb-4">🏆👻🦇🎃💀</p>

                <div className="mt-4">
                  <input
                    type="text"
                    placeholder="Enter your name..."
                    value={playerName}
                    onChange={(e) => setPlayerName(e.target.value)}
                    onKeyPress={(e) => e.key === 'Enter' && saveScore()}
                    className="w-full px-4 py-2 rounded-lg bg-black bg-opacity-50 text-white border-2 border-green-400 placeholder-gray-400 focus:outline-none focus:border-green-300 mb-3"
                    maxLength={20}
                    autoFocus
                  />
                  <button
                    onClick={saveScore}
                    className="w-full bg-gradient-to-r from-green-600 to-green-800 hover:from-green-700 hover:to-green-900 text-white font-bold py-2 px-4 rounded-lg transition-all border-2 border-green-400 hover:scale-105 active:scale-95"
                  >
                    Save Score to Hall of Fame! 🏆
                  </button>
                </div>
              </div>
            )}

            {isWon && !showNameInput && (
              <div className="mb-4 bg-gradient-to-r from-green-900 to-green-800 border-4 border-green-500 rounded-lg p-4 text-center shadow-xl relative overflow-hidden">
                <p className="text-green-300 font-bold text-3xl">Score Saved! 🎉</p>
                <p className="text-yellow-300 text-4xl mt-3">🏆👻🦇🎃💀</p>
              </div>
            )}

            <div className="grid grid-cols-3 gap-2 bg-black bg-opacity-60 p-3 rounded-xl border-4 border-orange-700 shadow-2xl relative">
              <div className="absolute -top-3 -left-3 text-3xl animate-spin" style={{animationDuration: '10s'}}>🕸️</div>
              <div className="absolute -top-3 -right-3 text-3xl animate-spin" style={{animationDuration: '8s', animationDirection: 'reverse'}}>🕸️</div>

{tiles.map((tile, index) => (
  <div
    key={index}
    onClick={() => handleTileClick(index)}
    onTouchStart={(e) => {
      e.preventDefault();
      handleTileClick(index);
    }}
    className={`aspect-square rounded-lg flex items-center justify-center text-2xl font-bold transition-all gpu-accelerated no-select tile-active ${
      tile === 8
        ? 'bg-gray-900 cursor-default border-2 border-orange-800'
        : 'bg-white cursor-pointer hover:scale-110 hover:rotate-3 max-md:tile-hover-disable shadow-md hover:shadow-2xl border-2 border-orange-600 hover:border-orange-400'
    } ${animatingTile === index ? 'blood-slide' : ''}`}
    style={getTileStyle(tile)}
  >
    {!image && tile !== 8 && (
      <span className="text-white drop-shadow-lg text-3xl animate-pulse" style={{textShadow: '2px 2px 8px black, 0 0 10px orange'}}>
        {tile + 1}
      </span>
    )}
  </div>
))}

              <div className="absolute -bottom-3 -left-3 text-2xl animate-bounce">🦇</div>
              <div className="absolute -bottom-3 -right-3 text-2xl animate-bounce" style={{animationDelay: '0.5s'}}>🐈‍⬛</div>
            </div>

            <div className="mt-6 text-center text-sm text-orange-200 italic flex items-center justify-center gap-2 animate-pulse">
              <span className="text-xl">🕷️</span>
              Click tiles near the void to move them
              <span className="text-xl">🕷️</span>
            </div>

            <div className="mt-4 flex justify-center gap-4 text-3xl">
              <span className="animate-bounce">🍬</span>
              <span className="animate-bounce" style={{animationDelay: '0.2s'}}>🍭</span>
              <span className="animate-bounce" style={{animationDelay: '0.4s'}}>🎃</span>
              <span className="animate-bounce" style={{animationDelay: '0.6s'}}>👻</span>
              <span className="animate-bounce" style={{animationDelay: '0.8s'}}>🦇</span>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<SlidingPuzzle />, document.getElementById('root'));
    </script>
</body>
</html>